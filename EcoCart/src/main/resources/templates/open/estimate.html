<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layout}">

<head>
   <meta charset="UTF-8">
   <title>Estimate</title>
	<link rel="stylesheet" href="https://uicdn.toast.com/grid/latest/tui-grid.css" />
	<script src="https://uicdn.toast.com/grid/latest/tui-grid.js"></script>
	 <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css">
	 
	
   
</head>

<body>
<div layout:fragment="content">
    <h4>견적서</h4>
	

	<div class="mb-3 mt-3 row">
	<form action="#" method="get">
		<div>
			<div class= "mb-3 row">
				<div class ="input-group mb-3">
					<div class="col-lg-auto col-sm-12"><label class="col-form-label" style="display:inline">견적번호</label></div>
					<div class="col-lg-2 col-sm-6" >
						<input  class="form-control" id="result">
					</div>
					<div class="col-lg-auto col-sm-12 col-form-label"><i class="bi bi-search">&nbsp;</i></div>
		         	<div class="col-lg-2 col-sm-12 col-form-label">
		         		<select name="no" onchange="handleOnChange(this)" class=form-control>
		         			<option value="">-선택-</option>
		         			<option value="번호1">번호1</option>
		         			<option value="번호2">번호2</option>
		         			<option value="번호3">번호3</option>   			
		         		</select>
		         	</div>
				</div>
	         		
	         	<div class ="input-group mb-3">
	         	<label  class="col-lg-1 col-sm-12 col-form-label" >거래처코드</label>
	         		<input style="width: 100px;" id="result">
	         		<i class="bi bi-search">&nbsp;</i>
	         		<select name="no" onchange="handleOnChange2(this)" style="width: 80px;">
	         			<option value="선택">-선택-</option>
	         			<option value="거래처1">거래처1</option>
	         			<option value="거래처2">거래처2</option>
	         			<option value="거래처3">거래처3</option>   			
	         		</select> 
	         	</div>
	         		
			
			</div>
		
			<table >
				<tr>
					<td style="width: 400px">견적번호<input style="width: 100px;" id="result">&nbsp; <i class="bi bi-search">&nbsp;</i>
	         		<select name="no" onchange="handleOnChange(this)" style="width: 80px;">
	         			<option value="">-선택-</option>
	         			<option value="번호1">번호1</option>
	         			<option value="번호2">번호2</option>
	         			<option value="번호3">번호3</option>   			
	         		</select>
	         		</td>
	         		
	         		<td>거래처코드 <input style="width: 100px;" id="result2">&nbsp; <i class="bi bi-search">&nbsp;</i>
	         		<select name="no" onchange="handleOnChange2(this)" style="width: 80px;">
	         			<option value="선택">-선택-</option>
	         			<option value="거래처1">거래처1</option>
	         			<option value="거래처2">거래처2</option>
	         			<option value="거래처3">거래처3</option>   			
	         		</select> 
	         		</td>
				</tr>
				
				<tr>
					<td>제품코드 <input style="width: 100px;" id="result3" >&nbsp; <i class="bi bi-search">&nbsp;</i>
	         		<select name="no" onchange="handleOnChange3(this)" style="width: 80px;">
	         			<option value="선택">-선택-</option>
	         			<option value="제품코드1">제품코드1</option>
	         			<option value="제품코드2">제품코드2</option>
	         			<option value="제품코드3">제품코드3</option>   			
	         		</select>
	         		</td>
	         		
					<td>제품명 <input style="width: 100px;" id="result4">&nbsp; <i class="bi bi-search">&nbsp;</i>
	         		<select name="no" onchange="handleOnChange4(this)" style="width: 80px;">
	         			<option value="선택">-선택-</option>
	         			<option value="제품명1">제품명1</option>
	         			<option value="제품명2">제품명2</option>
	         			<option value="제품명3">제품명3</option>   			
	         		</select>
	         		</td>
				</tr>
				
				<tr>
					<td>
						견적일자 <input type="date" style="width: 120px;">
					</td>
					
					<td>
						납기일자 <input type="date" style="width: 120px;"> 
					</td>
				</tr>
			</table>
		</div>

         <div style="margin-left: 3px;">
              
               <button type="button" style="width: 80px; background-color: black; color:white; float:right;  margin:5px; margin-right: 30px">승인</button>   
               <button  type="reset" style="width: 80px; background-color: black; color:white; float:right;  margin:5px;">초기화</button>
               <button id="showModal" type="button" style="width: 80px; background-color: black; color:white; float:right;  margin:5px;"
                  data-bs-toggle="modal" data-bs-target="#staticBackdrop">등 록</button>
              
               <button id="listbtn" type="button" style="width: 80px; background-color: black; color:white; float:right; margin:5px;">조 회</button>
         </div>
                  
      </form>
      </div>
      
	<div id ="grid"></div>
	
	<div><br></div>
	
	<div id ="grid2"></div>
	
	<!--  모달창  -->
      <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
		  <div class="modal-dialog modal-lg">
		    <div class="modal-content">
		    
		      <div class="modal-header">
		        <h5 class="modal-title" id="staticBackdropLabel">견적서 등록</h5>
		        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
		      </div>
		      
		      <div class="modal-body">
		        <table>
		        	<tr>
			        	<td style="width: 300px;">견적번호&nbsp;&nbsp;<input style="width: 100px;"></td>
			        	
			        	<td>거래처명 &nbsp;&nbsp;<input style="width: 100px;" id="result5">&nbsp; <i class="bi bi-search">&nbsp;</i>
			         		<select name="no" onchange="handleOnChange5(this)" style="width: 80px;">
			         			<option value="선택">-선택-</option>
			         			<option value="번호1">번호1</option>
			         			<option value="번호2">번호2</option>
			         			<option value="번호3">번호3</option>   			
			         		</select>
			   			</td>
			   		</tr>
			   		
			   		<tr>
			   			<td>
							견적일자 <input type="date" style="width: 120px;">
						</td>
				
						<td>
							납기일자 <input type="date" style="width: 120px;">
						</td>
			   		
			   		</tr>
			   		
			   		<tr>
			   			<td>제품코드&nbsp;&nbsp;<input style="width: 100px;" id="result6">&nbsp; <i class="bi bi-search">&nbsp;</i>
			         		<select name="no" onchange="handleOnChange6(this)" style="width: 80px;">
			         			<option value="선택">-선택-</option>
			         			<option value="번호1">번호1</option>
			         			<option value="번호2">번호2</option>
			         			<option value="번호3">번호3</option>   			
			         		</select>
			   			</td>
			   			
			   			<td>&nbsp;&nbsp;제품&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input style="width: 100px;" id="result7">&nbsp; <i class="bi bi-search">&nbsp;</i>
			         		<select name="no" onchange="handleOnChange7(this)" style="width: 80px;">
			         			<option value="선택">-선택-</option>
			         			<option value="번호1">번호1</option>
			         			<option value="번호2">번호2</option>
			         			<option value="번호3">번호3</option>   			
			         		</select>
			   			</td>
			   			<td>수량<input type="text" style="width: 100px;"></td>
			   		</tr>

			   		
		        </table>
			    <button type="button" class="btn btn-primary" style="float:right">제품추가</button>
		      </div>
		        
		        
					 <div id ="grid3"></div>
				
		        
		      <div class="modal-footer">
		        <button type="button" class="btn btn-primary">등록</button>
		        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
		      </div>
		      
		    </div>
		  </div>
		</div>
	    
	    <!--  모달창 끝 -->
    

	


	<script>
	
		const Grid = tui.Grid;
		
		
		const grid = new Grid({
            el: document.getElementById('grid'), // Container element
            scrollX: false,
            scrollY: false,
            rowHeaders: ['checkbox'],
            columns: [
                {
                	header: '견적코드',
                	name: 'estmtCode',
                	filter : 'select'
                },
                {
                	header: '거래처',
                	name: 'clientCode',
                	filter : 'select',
                	
                },
                {
                	header: '견적일자',
                    name: 'estmtDate',
                    filter : 'select'
                 },
                 {
                 	header: '납기일자',
                    name: 'deDate',
                    filter : 'select'
                 },
                 {
                  	header: '총합계액',
                     name: 'allSum'
                  },
                  {
                	  header:'승인',
                	  name: 'estmtSt'
                  }
                  
	
                //체크박스
                /* {
                    header: '승인',
                    name: 'estmtSt1',
                    formatter: 'listItemText',
                    editor: {
                                type: 'checkbox',
                                options: {
                                    listItems: [
                                        {
                                            text: 'O',
                                            value: '1'
                                        },
                                        {
                                            text: 'X',
                                            value: '2'
                                        }
                                    ]
                                }
                            }
                }, */

            ]
           
	
		});
		
		
		const grid2 = new Grid({
            el: document.getElementById('grid2'), // Container element
            scrollX: false,
            scrollY: false,
            columns: [
                {
                	header: 'no',
                	name: 'ESTMT_DNO'
                },
                {
                	header: '제품코드',
                	name: 'PRO_CODE'
                },
                {
                	header: '제품명',
                    name: 'PRO_NAME'
                 },
                 {
                 	header: '수량',
                    name: 'SELL_NUM'
                 },
                 {
                  	header: '단가',
                     name: 'SELL_PRICE'
                  },
                 
                 {
                  	header: '합계액',
                     name: 'SUM_PRICE'
                  },
                  
                  
            ]
            /* data: [
                {
                	estmtDno: '01',
                	proCode: 'pro01',
                	proName: '2022-11-14',
                	sellNum : '5',
                	sellPrice : '4000',
                	sumPrice : '20000'
                  
                    
                }
			] */
		});
		
		
		const grid3 = new Grid({
            el: document.getElementById('grid3'), // Container element
            scrollX: false,
            scrollY: false,
            columns: [
                {
                	header: '제품코드',
                	name: 'proCode'
                },
                {
                	header: '제품명',
                	name: 'proName'
                },
                 {
                 	header: '수량',
                    name: 'sellNum'
                 },
                 {
                  	header: '단가',
                     name: 'sellPrice'
                  },
                 
                 {
                  	header: '합계액',
                     name: 'sumPrice'
                  }
                  
            ],
            data: [
                {
                	estmtDno: '01',
                	proCode: 'pro01',
                	proName: '2022-11-14',
                	sellNum : '5',
                	sellPrice : '4000',
                	sumPrice : '20000'
                  
                    
                }
			]
		});
		
		
		Grid.applyTheme('striped'); // Call API of static method
		
		
		
		
		
		function handleOnChange(e){
			//선택된 데이터의 텍스트값 가져오기
			const text = e.value;
			
			//선택한 텍스트 출력
			document.getElementById('result').value = text;
		}
		
		function handleOnChange2(e){
			//선택된 데이터의 텍스트값 가져오기
			const text = e.value;
			
			//선택한 텍스트 출력
			document.getElementById('result2').value = text;
		}
		
		function handleOnChange3(e){
			//선택된 데이터의 텍스트값 가져오기
			const text = e.value;
			
			//선택한 텍스트 출력
			document.getElementById('result3').value = text;
		}
		
		function handleOnChange4(e){
			//선택된 데이터의 텍스트값 가져오기
			const text = e.value;
			
			//선택한 텍스트 출력
			document.getElementById('result4').value = text;
		}
		function handleOnChange5(e){
			//선택된 데이터의 텍스트값 가져오기
			const text = e.value;
			
			//선택한 텍스트 출력
			document.getElementById('result5').value = text;
		}
		function handleOnChange6(e){
			//선택된 데이터의 텍스트값 가져오기
			const text = e.value;
			
			//선택한 텍스트 출력
			document.getElementById('result6').value = text;
		}
		function handleOnChange7(e){
			//선택된 데이터의 텍스트값 가져오기
			const text = e.value;
			
			//선택한 텍스트 출력
			document.getElementById('result7').value = text;
		}
		
		//수량 * 단가 = 합계액
		function add(){
			if(document.getElementById("num").value && document.getElementById("price").value){
				
			}
				  document.getElementById('allsum').value =
					  parseInt(document.getElementById('num').value) * parseInt(document.getElementById('price').value);
		}
		
		
		
		
	//모달창
   	staticBackdrop.addEventListener('shown.bs.modal', () => {
   	      grid3.refreshLayout(); //모달창 새로고침
   	 })
		
   	 
   	//조건조회(클릭)
	document.getElementById("listbtn").addEventListener("click",estmtList)
   	
	function estmtList(){
		$.ajax({
			url:'/listEstimate',
			success : function(result) {
				grid.resetData(result);
				console.log("aa",result); 
			},
			error : function(error){
				console.log(11);
			}
		})
		
	}
	
	//실행시 전체조회
	document.addEventListener("DOMContentLoaded",estmtList)
	   	
		function estmtList(){
			console.log('12');
			$.ajax({
				url:'/listEstimate',
				success : function(result) {
					console.log(result)
					grid.resetData(result);
				},
				error : function(error){
					console.log(11);
				}
			})
			
		}
   	 
	
	

	
	 //tr clickevent
	 grid.on('click', (event)=>{
		 console.log('clicked');
		 console.log(event.nativeEvent.target.textContent);		//d
		 var a  = event.nativeEvent.target.textContent;
				
		 $.ajax({
					method:'GET',
					url:'/listEstimated?estmtCode='+a,
					success : function(result) {
						console.log(result)
						grid2.resetData(result);
					},
					error : function(error){
						console.log(11);
					}
				})
				
			
		 
		 
		 
		 
	 })
	
	
	</script>
	</div>
</body>

</html>