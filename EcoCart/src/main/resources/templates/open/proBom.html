<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layout}">

<head>
   <meta charset="UTF-8">
   <title>proBom 재고현황/BOM수급현황</title>
	<link rel="stylesheet" href="https://uicdn.toast.com/grid/latest/tui-grid.css" />
	<script src="https://uicdn.toast.com/grid/latest/tui-grid.js"></script>
	 <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css">
	
</head>

<body>
<div layout:fragment="content">

	<h4>재고현황/BOM수급현황</h4>
	
	<div class="row">
		<div>
			<table style="margin:30px;">
				<tr>
					<td style="width: 400px;">제품코드<input style="width: 100px;" id="result">&nbsp; <i class="bi bi-search">&nbsp;</i>
		         		<select name="no" onchange="handleOnChange(this)" style="width: 80px;">
		         			<option value="선택">-선택-</option>
		         			<th:block th:each="e : ${proCode}">
					         	<option th:value="${e.proCode}" th:text="${e.proCode}"></option>
				         	</th:block>   		   			
		         		</select>
	         		</td>
	         		
	         		<td >제품명<input style="width: 100px;" id="result2">&nbsp; <i class="bi bi-search">&nbsp;</i>
		         		<select name="no" onchange="handleOnChange2(this)" style="width: 80px;">
		         			<option value="선택">-선택-</option>
		         			<th:block th:each="e : ${proCode}">
					         	<option th:value="${e.proName}" th:text="${e.proName}"></option>
				         	</th:block>  			
		         		</select>
	         			<button type="button" style="width: 80px; background-color: black; color:white;  margin-left:20px;">조 회</button>
	         		</td>
	         		
				</tr>
			</table>	
		</div>
	
		<div id="grid"></div>
	
	</div>
	
	<div class="row">
		<div>
			<table style="margin:30px;">
				<tr>
					<td style="width: 400px;">BOM코드<input style="width: 100px;" id="result3">&nbsp; <i class="bi bi-search">&nbsp;</i>
		         		<select name="no" onchange="handleOnChange3(this)" style="width: 80px;">
		         			<option value="선택">-선택-</option>
		         			<th:block th:each="e : ${bomCode}">
					         	<option th:value="${e.bomCode}" th:text="${e.bomCode}"></option>
				         	</th:block>   			
		         		</select>
	         		</td>
	         		
				</tr>
			</table>	
		</div>
	
		<div id="grid2"></div>
	
	</div>
	   

		<script>
	
		const Grid = tui.Grid;
		
		
		const grid = new Grid({
	        el: document.getElementById('grid'), // Container element
	        scrollX: false,
            scrollY: false,
	        columns: [
	            {
	            	header: '제품코드',
	            	name: 'proCode'
	            },
	            {
	            	header: '제품명',
	            	name: 'proName'
	            },
	            {
	            	header: '창고코드',
	                name: 'whCode'
	             },
	             {
		             header: '수량',
		             name: 'proNum'
		         },
	             {
		             header: 'bom코드',
		             name: 'bomCode'
		         }
	            
	        ]
			
		});
		
		Grid.applyTheme('striped'); // Call API of static method
	
		
		
		const grid2 = new Grid({
	        el: document.getElementById('grid2'), // Container element
	        scrollX: false,
            scrollY: false,
	        columns: [
	        	{
	            	header: 'BOM코드',
	            	name: 'BOM_CODE'
	            },
	            {
	            	header: '품번코드',
	                name: 'PRO_CODE'
	             },
	             {
		            header: '품명',
		            name: 'PRO_NAME'
		         },
	             {
		            header: '필요수량',
		            name: 'NEED_NUM'
	             },
	             {
	              	header: '재고수량',
	                name: 'BOM_NUM'
	             }
	              
	        ]
		});
	
			
	
		
		function handleOnChange(e){
			//선택된 데이터의 텍스트값 가져오기
			const text = e.value;
			
			//선택한 텍스트 출력
			document.getElementById('result').value = text;
		}
		
		function handleOnChange2(e){
			//선택된 데이터의 텍스트값 가져오기
			const text = e.value;
			
			//선택한 텍스트 출력
			document.getElementById('result2').value = text;
		}
	
		function handleOnChange3(e){
			//선택된 데이터의 텍스트값 가져오기
			const text = e.value;
			
			//선택한 텍스트 출력
			document.getElementById('result3').value = text;
		}
		
		function handleOnChange4(e){
			//선택된 데이터의 텍스트값 가져오기
			const text = e.value;
			
			//선택한 텍스트 출력
			document.getElementById('result4').value = text;
		}
	
		
		
		//
		document.addEventListener("DOMContentLoaded",proList)
		
		function proList(){
			
			$.ajax({
				
				url:'/productList',
				success:function(result){
					console.log("연결");
					console.log(result);
					grid.resetData(result);
				},
				error : function(error){
					console.log(error);
				}
			})
		}
			
		
		//
		grid.on("click", (event)=>{
			var a  = event.nativeEvent.target.textContent;
			
			$.ajax({
				method:'GET',
				url:'/bomList?proCode='+a,
				success:function(result){
					console.log("연결1");
					console.log(result);
					
					grid2.resetData(result);
					
				},
				error : function(error){
					console.log(error);
				}
				
			})
		})
		
		
		
		
		
		
		
		
		
		
		
		
	</script>
	
	
	</div>
	
	
	
	
	
</body>
</html>