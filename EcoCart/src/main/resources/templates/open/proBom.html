<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layout}">

<head>
   <meta charset="UTF-8">
   <title>proBom 재고현황/BOM수급현황</title>
	<link rel="stylesheet" href="https://uicdn.toast.com/grid/latest/tui-grid.css" />
	<script src="https://uicdn.toast.com/grid/latest/tui-grid.js"></script>
	 <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css">
	
</head>

<body>
<div layout:fragment="header" class="page-heading"><h2>재고현황/BOM수급현황</h2></div>
	<div layout:fragment="content" class="page-content">
				
		<div class="mb-1">
				
			<div style="height:50px; margin-bottom:10px">
				<label for="planName" style="width:100px">제품코드</label>
				<input type="text" class="form-control" style="width:200px; display:inline" placeholder="제품코드" id="InProductCode">&nbsp;
				
			</div>	
				
				
			<div style="height:50px; margin-bottom:10px">
				<label for="planName" style="width:100px">제품명</label>
				<input type="text" class="form-control" style="width:200px; display:inline" placeholder="제품명" id="InProduct">&nbsp;
				<button type="button" class="btn btn-sm btn-primary" id="proSearch">검색</button>&nbsp;					
				<button type="button" class="btn btn-sm btn-secondary" id="proReset">초기화</button>
				
			</div>

			
          </div>
	
		<div id="grid"></div>
		<div><br></div>
	
	<div class="mb-1">
		
				
			<div style="height:50px; margin-bottom:10px">
				<label for="planName" style="width:100px">BOM코드</label>
				<input type="text" class="form-control" style="width:200px; display:inline" placeholder="BOM코드" id="InBomCode">&nbsp;
				<button type="button" class="btn btn-sm btn-primary" id="bomSearch">검색</button>&nbsp;					
				<button type="button" class="btn btn-sm btn-secondary" id="bomReset">초기화</button>
				
			</div>

			
          </div>
	
		<div id="grid2"></div>
	
	   

		<script>
	
		const Grid = tui.Grid;
		
		
		const grid = new Grid({
	        el: document.getElementById('grid'), // Container element
	        scrollX: false,
            scrollY: false,
	        columns: [
	            {
	            	header: '제품코드',
	            	name: 'proCode',
	            	filter : 'text'
	            },
	            {
	            	header: '제품명',
	            	name: 'proName',
	            	filter : 'text'
	            },
	            {
	            	header: '창고코드',
	                name: 'whCode'
	             },
	             {
		             header: '수량',
		             name: 'proNum'
		         },
	             {
		             header: 'bom코드',
		             name: 'bomCode'
		         }
	            
	        ]
			
		});
		
		Grid.applyTheme('striped'); // Call API of static method
	
		
		
		const grid2 = new Grid({
	        el: document.getElementById('grid2'), // Container element
	        scrollX: false,
            scrollY: false,
	        columns: [
	        	{
	            	header: 'BOM코드',
	            	name: 'bomCode',
	            	filter : 'text'
	            	
	            },
	            {
	            	header: '품번코드',
	                name: 'prdCode'
	             },
	             {
		            header: '품명',
		            name: 'proName'
		         },
	             {
		            header: '필요수량',
		            name: 'needNum'
	             },
	             {
	              	header: '재고수량',
	                name: 'bomNum'
	             }
	              
	        ]
		});
	
			
	
		
		function handleOnChange(e){
			//선택된 데이터의 텍스트값 가져오기
			const text = e.value;
			
			//선택한 텍스트 출력
			document.getElementById('result').value = text;
		}
		
		function handleOnChange2(e){
			//선택된 데이터의 텍스트값 가져오기
			const text = e.value;
			
			//선택한 텍스트 출력
			document.getElementById('result2').value = text;
		}
	
		function handleOnChange3(e){
			//선택된 데이터의 텍스트값 가져오기
			const text = e.value;
			
			//선택한 텍스트 출력
			document.getElementById('result3').value = text;
		}
		
		function handleOnChange4(e){
			//선택된 데이터의 텍스트값 가져오기
			const text = e.value;
			
			//선택한 텍스트 출력
			document.getElementById('result4').value = text;
		}
	
		
		
		//
		document.addEventListener("DOMContentLoaded",proList)
		
		function proList(){
			
			$.ajax({
				
				url:'/productList',
				success:function(result){
					console.log("연결");
					console.log(result);
					grid.resetData(result);
				},
				error : function(error){
					console.log(error);
				}
			})
		}
			
		
		//
		grid.on("click", (event)=>{
			var a  = event.nativeEvent.target.textContent;
			
			$.ajax({
				method:'GET',
				url:'/bomList?proCode='+a,
				success:function(result){
					console.log("연결1");
					console.log(result);
					
					grid2.resetData(result);
					
				},
				error : function(error){
					console.log(error);
				}
				
			})
		})
	
		// 그리드 필터
	proSearch.addEventListener('click', () => {
		grid.filter('proName' , [{code:'contain', value:$('#InProduct').val()}])
		grid.filter('proCode' , [{code:'contain', value:$('#InProductCode').val()}])
			
		
	});


	proReset.addEventListener('click', () => {
		document.getElementById('InProduct').value = '';
		grid.unfilter('proName');
		document.getElementById('InProductCode').value = '';
		grid.unfilter('proCode');
	})	
		
	
	bomSearch.addEventListener('click', () => {
		grid2.filter('bomCode' , [{code:'contain', value:$('#InBomCode').val()}])
			
		
	});


	bomReset.addEventListener('click', () => {
		document.getElementById('InBomCode').value = '';
		grid2.unfilter('bomCode');
	})	
		
		
		
		
		
		
		
		
	</script>
	
	
	</div>
	
	
	
	
	
</body>
</html>