<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layout}">

<head>
   <meta charset="UTF-8">
   <title>Order</title>
	<link rel="stylesheet" href="https://uicdn.toast.com/grid/latest/tui-grid.css" />
	<script src="https://uicdn.toast.com/grid/latest/tui-grid.js"></script>
	 <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css">
	
</head>

<body>
<div layout:fragment="content">

	<h4>주문</h4>
	
	<div class="mb-3 row">
	<form action="#" method="get">
		<div>
			<table style="margin:30px;">
	         	<tr >
					<td>진행구분
						<label><input type="radio" name="orderSt" value="all" checked>전체</label>
						<label><input type="radio" name="orderSt" value="go">진행</label>
						<label><input type="radio" name="orderSt" value="done">마감</label>
						<label><input type="radio" name="orderSt" value="go">완료</label>
					</td> 
				</tr>
				
	         	<tr>	
					<td class="col-lg-5 col-sm-12 col-form-label" >주문코드<input class="form-control" style="width: 100px;" id="result2">&nbsp; <i class="bi bi-search">&nbsp;</i>
		         		<select class="form-control" name="no" onchange="handleOnChange2(this)" style="width: 80px;">
		         			<option value="">-선택-</option>
		         			<option value="번호1">번호1</option>
		         			<option value="번호2">번호2</option>
		         			<option value="번호3">번호3</option>   			
		         		</select>
	         		 	<button type="button" style="width: 80px; background-color: black; color:white;  margin-left:20px;">조 회</button>
	         		 	<button type="button" style="width: 150px; background-color: black; color:white;" data-bs-toggle="modal" data-bs-target="#staticBackdrop">승인 견적서 조회</button>
	         	
	         		</td>
				</tr>
			</table>
		</div>	
	
	
	</form>
		<div id="grid"></div>
		<div id="grid2"></div>
		
	</div>
	
	<div class="row">
		<table style="margin:30px;">
			<tr>
				<td>제품코드<input style="width: 100px;" id="result3">&nbsp; <i class="bi bi-search">&nbsp;</i>
	         		<select name="no" onchange="handleOnChange3(this)" style="width: 80px;">
	         			<option value="선택">-선택-</option>
	         			<option value="번호1">번호1</option>
	         			<option value="번호2">번호2</option>
	         			<option value="번호3">번호3</option>   			
	         		</select>
         			<button type="button" style="width: 80px; background-color: black; color:white;  margin-left:20px;">조 회</button>
         		</td>
			</tr>
		</table>	
	</div>
	
	
	<div id="grid3"></div>
	
	
	
	
	<!--  견적코드 모달창  -->
      <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
		  <div class="modal-dialog modal-lg">  
		    <div class="modal-content">
		    
		      <div class="modal-header">
		        <h5 class="modal-title" id="staticBackdropLabel">견적서</h5>
		        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" ></button>
		      </div>
		        
		      <div class="modal-body">
				  <div class="container-fluid">
				  	<table style="margin:30px;">
						
						<tr>
							<td>견적코드<input style="width: 100px;" id="result4">&nbsp; <i class="bi bi-search">&nbsp;</i>
				         		<select name="no" onchange="handleOnChange4(this)" style="width: 80px;">
				         			<option value="선택">-선택-</option>
				         			<th:block th:each="e : ${estmtCode1}">
				         				<option th:value="${e.estmtCode}" th:text="${e.estmtCode}"></option>
				         			</th:block>  			
				         		</select>
			         		 	<button onclick="searchEstmtCode()" type="button" style="width: 80px; background-color: black; color:white;  margin-left:20px;">조 회</button>
		         			</td>
						</tr>
						
					</table>
				</div>
			 </div>
			 
			 		<div id="grid4"></div>
			 		<div id="grid5"></div>
		      
		      <div class="modal-footer">
		        <button type="button" class="btn btn-primary">주문 등록</button>
		        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
		      </div>
		      
		    </div>
		  </div>
		</div>
	    
	    <!--  모달창 끝 -->
	    
	   
	    
	    
	
		<script>
	
		const Grid = tui.Grid;
		
		//주문목록 
		const grid = new Grid({
	        el: document.getElementById('grid'), // Container element
	        scrollX: false,
            scrollY: false,
            rowHeaders: ['checkbox'],
	        columns: [
	            {
	            	header: '주문코드',
	            	name: 'orderCode',
	            	filter : 'select'
	            },
	            {
	            	header: '거래처',
	            	name: 'clientCode',
	            	filter : 'select'
	            },
	            {
	            	header: '주문등록일자',
	                name: 'orderDate',
	                filter : 'select'
	                
	             },
	             {
	             	header: '납기일자',
	                name: 'deDate',
	                filter : 'select'
	             },
	             {
	                 header: '총합계액',
	                 name: 'allSum'
	             },
	             {
               	  	header:'승인',
               	  	name: 'orderSt',
               	 	filter : 'select'
                 }
                 
	            
	        ]
		});
		
		Grid.applyTheme('striped'); // Call API of static method
	
		
		
		
		//상세조회
		const grid2 = new Grid({
	        el: document.getElementById('grid2'), // Container element
	        scrollX: false,
            scrollY: false,
	        columns: [
	            {
	            	header:'no',
	            	name:'ORDER_DNO'
	            },
	        	{
	            	header: '제품코드',
	            	name: 'PRO_CODE',
	            	
	            },
	            {
	            	header: '제품명',
	                name: 'PRO_NAME'
	             },
	             {
	             	header: '수량',
	                name: 'SELL_NUM'
	             },
	             {
	              	header: '단가',
	                 name: 'SELL_PRICE'
	              },
	             
	             {
	              	header: '합계액',
	                 name: 'SUM_PRICE'
	              }
	              
	        ]
		});
	
		//제품재고 조회
		const grid3 = new Grid({
	        el: document.getElementById('grid3'), // Container element
	        scrollX: false,
            scrollY: false,
	        columns: [
	        	{
	            	header: '제품코드',
	            	name: 'proCode',
	            	filter : 'select'
	            },
	            {
	            	header: '제품명',
	                name: 'proName',
	                filter : 'select'
	             },
	             {
	             	header: '제품재고수량',
	                name: 'proNum'
	             }
	              
	        ]
		});
		
		
		
		//견적코드 모달창
		const grid4 = new Grid({
	        el: document.getElementById('grid4'), // Container element
	        scrollX: false,
            scrollY: false,
            rowHeaders : ['checkbox'],
	        columns: [
	        
	        	{
                	header: '견적코드',
                	name: 'estmtCode'
                },
                {
                	header: '거래처',
                	name: 'clientCode'
                },
                {
                	header: '견적일자',
                    name: 'estmtDate'
                 },
                 {
                 	header: '납기일자',
                    name: 'deDate'
                 },
                 {
                  	header: '총합계액',
                     name: 'fallSum'
                  },
	        ]
		});
		
		
		
		//견적코드 모달창
		const grid5 = new Grid({
	        el: document.getElementById('grid5'), // Container element
	        scrollX: false,
            scrollY: false,
	        columns: [
	        
	        	{
                	header: '제품코드',
                	name: 'PRO_CODE'
                },
                {
                	header: '제품명',
                	name: 'PRO_NAME'
                },
                 {
                 	header: '수량',
                    name: 'SELL_NUM'
                 },
                {
                	header: '단가',
                    name: 'fsell_price'
                 },
                 {
                  	header: '합계액',
                     name: 'FSUM_PRICE'
                  },
	        ]
		});
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		function handleOnChange(e){
			//선택된 데이터의 텍스트값 가져오기
			const text = e.value;
			
			//선택한 텍스트 출력
			document.getElementById('result').value = text;
		}
		
		function handleOnChange2(e){
			//선택된 데이터의 텍스트값 가져오기
			const text = e.value;
			
			//선택한 텍스트 출력
			document.getElementById('result2').value = text;
		}
	
		function handleOnChange3(e){
			//선택된 데이터의 텍스트값 가져오기
			const text = e.value;
			
			//선택한 텍스트 출력
			document.getElementById('result3').value = text;
		}
		
		function handleOnChange4(e){
			//선택된 데이터의 텍스트값 가져오기
			const text = e.value;
			
			//선택한 텍스트 출력
			document.getElementById('result4').value = text;
		}
	
		
		
		
		//수량 * 단가 = 합계액
		function add(){
			if(document.getElementById("sellNum").value && document.getElementById("sellPrice").value){
				
			}
				  document.getElementById('sumPrice').value =
					  parseInt(document.getElementById('sellNum').value) * parseInt(document.getElementById('sellPrice').value);
		}
		
		
		
		
		//모달창
	   	staticBackdrop.addEventListener('shown.bs.modal', () => {
	   	      grid4.refreshLayout(); //모달창 새로고침
	   	 })
	   	 
	   	 //모달창
	   	staticBackdrop.addEventListener('shown.bs.modal', () => {
	   	      grid5.refreshLayout(); //모달창 새로고침
	   	 })
			
			
		//실행시 조회
		document.addEventListener("DOMContentLoaded",ordersList)
	   	
		function ordersList(){
			console.log("연결성공")
			$.ajax({
				url:'/listOrders',
				success : function(result) {
					console.log(result);
					grid.resetData(result);
				},
				error : function(error){
					console.log(error);
				}
			}),
			
			$.ajax({
				url:'/proList',
				success : function(result) {
					console.log(result);
					grid3.resetData(result);
				},
				error : function(error){
					console.log(error);
				}
			})
			
		}
   	 
		
		
		//tr click
		grid.on('click', (event)=>{
			console.log(event.nativeEvent.target.textContent);
			var a = event.nativeEvent.target.textContent;
			
			$.ajax({
				method:'GET',
				url:'/listOrderd?orderCode='+a,
				success : function(result){
					grid2.resetData(result)
				},
				error: function(error){
					console.log(error);
				}
				
			})
		})
			
		
		
		//모달창 견적코드 조회
		function searchEstmtCode(){
			
			console.log(document.getElementById('result4').value);
			var a = document.getElementById('result4').value  
			
			$.ajax({
				method:'GET',
				url:'/MestmtList?estmtCode='+a,
				success : function(result){
					grid4.resetData(result)
				},
				error: function(error){
					console.log(error+"k");
				}
				
			}),
			
			$.ajax({
				method:'GET',
				url:'/MestmtListD?estmtCode='+a,
				success : function(result){
					console.log(JSON.stringify(result) + "dddd");
					console.log(result+"d");	//객체로 들어옴 -> ?
					grid5.resetData(result)
				},
				error: function(error){
					console.log(error+"mm");
				}
				
			})
		}
		
		
		//제품 조회 -> 일단 실행시 전체 조회로 만들어둠 ()
/* 		document.getElementById("proListbtn").addEventListener("click",proList)
		
		document.addEventListener("DOMContentLoaded",proList)
		
		function proList(){
			console.log('제품 조회 연결')
			$.ajax({
				url:'/proList',
				success : function(result) {
					console.log(result);
					grid3.resetData(result);
				},
				error : function(error){
					console.log(error);
				}
			})
		} */
			
		
		
		
		//모달창 승인 견적서조회
/* 		function OkEstimate(){
			
			$.ajax({
				url:'/OkEstimate',
				success: : function(result) {
					console.log(result);
						$.("#result4 option:selected").val(); 
				}
			})
		
		} */
	</script>
	
	
	</div>
	
	
	
	
	
</body>
</html>