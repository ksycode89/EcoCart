<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"  
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/layout/layout}">
<head>
<meta charset="UTF-8">
<meta id="_csrf" name="_csrf" th:content="${_csrf.token}"/>
<meta id="_csrf_header" name="_csrf_header" th:content="${_csrf.headerName}"/>
<title>발주현황</title>
</head>
<body>
	<div layout:fragment="content" class="page-content">
	
		<div id="content">
			<h2>발주현황</h2>
			
			<div class="filters mt-4" style="height:35px" >
				<label for="planStatus" style="width:100px">진행구분</label>
				<label><input type="radio" id="planAll"  name="plan"value="all" checked>전체</label>&nbsp;
				<label><input type="radio" id="planStart"  name="plan" value="start">대기</label>&nbsp;
				<label><input type="radio" id="planWait"  name="plan" value="wait">승인</label>
			</div>
			
			<label for="code_group" style="width:80px;">담당자</label>
			<input type="text" id="codeGroup" name="code_group" class="form-control" style="width:150px; display:inline"><br>
			<label for="code_group" style="width:80px;">발주날짜</label>
			<input type="date"  id="searchDate" class="form-control" style="width:150px; display:inline">
			
		<div class="mb-3 row flex-right mt-3">
				<div class="col-lg-auto col-sm-12 ">
			        <button class="ml-5 btn btn-sm btn-primary" onclick="getList()">조회</button>
					<button class="ml-5 btn btn-sm btn-secondary" onclick="window.location.reload()">초기화</button>
					<button class="ml-5 btn btn-sm btn-secondary" onclick="cancel()">발주취소</button>
				</div>
		</div>
		
		</div>
		<div class="row">
			<div>
				<div id="grid"></div>
			</div>
		</div>
			<div class="col-8" >
				<div id="grid2" style="width: 1450px" ></div>
			</div>
		<br>
		
		
		<script>
	
		var token = $("meta[name='_csrf']").attr("content");
		var header = $("meta[name='_csrf_header']").attr("content");
		
	   const grid = new tui.Grid({
	          el: document.getElementById('grid'),
	          scrollX: false,
	          scrollY: false,
	          rowHeaders : ['checkbox'],
	          columns: [
	            {
	              header: '발주번호',
	              name: 'orderNo',
	            },
	            {
	              header: '발주일자',
	              name: 'orderDate',
	              editor: {
	                  type: 'datePicker', 
	              option : {
	            	  format:'yyyy-MM-dd',
	              }
	             }
	              },
	              {
	              header: '납기일',
	              name: 'orderReceiving',
	              editor: {
	              type: 'datePicker',
	              options: {
	              format: 'yyyy-MM-dd'
	             }
	             }
	            },
	            {
	            	header: '거래처코드',
	            	name: 'clientName'
	            	
	            },
	            {
	              header: '담당자',
	              name: 'empName',
	            },
	            {
	                header: '담당자사번',
	                name: 'empNum',
	            },
	            {
	              header: '진행상황',
	              name: 'orderGroup',
	              editor: 'text'
	            }
	           
	          ] ,pageOptions: {
	    	        useClient: true,
	    	        perPage:20
	    	      }
	   	
	      
	  });
		    
   //상세조회
	  var grid2 = new tui.Grid({
	    el: document.getElementById('grid2'),
	    rowHeders : ['rowNum'], 
	    scrollX: false,
	    scrollY: false,
	    columns: [
	      {
	        header: '품번',
	        name: 'proCode'
	      },
	      {
	        header: '품명',
	        name: 'proName'
	      },
	      {
	        header: '규격',
	        name: 'standard'
	      },
	      {
	        header: '단위',
	        name: 'unit'
	      },
	      {
	        header: '발주수량',
	        name: 'orderNum'
	        },
	        {
	        header: '검사수량',
	        name: 'checkNum'
	          }
	    ]
	  });	  
	   
   
	   grid.on('click',(ab)=>{
		   //console.log(ab.nativeEvent.target.innerText)
		   $.ajax({
			   url:'/detailList',
			   data : {'orderNo' : grid.getRow(ab.rowKey).orderNo},
			   success : function(data) {
				   //console.log(data);
				   grid2.resetData(data);				   
				   
			   },
			   error :  function(reject) {
				   console.log(111)
			   }
		   })
		   
	   })
	   
	  
	/* =================기=능===================== */
	function getList (){
		   $.ajax({
				url : '/materialListInfo',
				success : function(data) {
					grid.resetData(data)
					console.log(data);
				},
				error : function(reject) {
					console.log(reject);
				}
			})
		   
	   }

	
	   
   </script>
	</div>
</body>
</html>