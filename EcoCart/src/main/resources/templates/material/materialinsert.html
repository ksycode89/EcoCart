<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
   layout:decorate="~{layout/layout}">   
<head>
<meta charset="UTF-8">
<title>발주 등록</title>
</head>
<body>
<div layout:fragment="content" class="page-content">
   <div id="content">
      <h2>발주등록</h2>
      <label for="code_group" style="width:65px;" >부서</label>
      <input id="empDept" type="text"> <i class="bi bi-search" id="emplist" data-bs-toggle="modal" data-bs-target="#staticBackdrop" style="cursor:pointer"></i>
       사원 <input id="empName" type="text">     
   </div>
   
   
   <!-- Modal -->
			<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static"
				data-bs-keyboard="false" tabindex="-1"
				aria-labelledby="staticBackdropLabel" aria-hidden="true">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<h1 class="modal-title fs-5" id="staticBackdropLabel">사원 목록</h1>
							<button type="button" class="btn-close" data-bs-dismiss="modal"
								aria-label="Close"></button>
						</div>
						<div class="modal-body">
							<div id="modalGrid"></div>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary"
								data-bs-dismiss="modal">확인</button>
						</div>
					</div>
				</div>
			</div>
   <script>
      
   </script>
   
   <div style="margin-left: 3px;">   
               <button id="insertBtn" type="button" style="width: 80px; background-color: black; color:white; float:right; margin:5px;">등록</button>
         </div>
   <div id="grid"></div>   
   <div id="grid2"></div>
   <script>
   
   $(document).ready(function() {
      $('#emplist').click(empList)
      $('#insertBtn').click(insertInfo)
   })
   
   function insertInfo() {
	   $.ajax({
		   url : '/materialinsertInfo',
		   type : 'POST',
		   success : function(data) {
			   console.log(data);
		   },
		   error : function(rejcet) {
			   console.log(123);
		   }
	   })
   }
   
   function empList() {
      $.ajax({
         url : 'ajax/list',
         type : 'POST',
         data : {"empNum" : $('#empNum').val(),"empDept" : $('#codeId').val()},
         success : function(data) {
            console.log(data);
            modalGrid.resetData(data);
         },
         error : function(rejcet) {
            console.log(no);
         }
      })
   }
   
   const gridData = [
          {
             name:'',
             artist:'',
             type:'',
             position : "bottom",
             release:'',
             genre:''
          }];
  
      const grid = new tui.Grid({
          el: document.getElementById('grid'),
          scrollX: false,
          scrollY: false,
          position : "bottom",
          columns: [
            {
              header: '발주번호',
              name: 'orderNo',
              editor: 'text'
            },
            {
              header: '발주일자',
              name: 'orderDate',
              editor: {
                  type: 'datePicker', 
              option : {
            	  format:'yyyy-MM-dd'
              }
              }
            },
            {
              header: '거래처명',
              name: 'clientName',
           	  editor: 'text',
            },
            {
              header: '담당자',
              name: 'manager',
              filter : 'text'
            },
            {
              header: '비고',
              name: 'comments',
              editor: 'text'
            }
          ]
        });
      
   
  const grid2 = new tui.Grid({
    el: document.getElementById('grid2'),
    data: gridData,
    scrollX: false,
    scrollY: false,
    rowHeaders : ['rowNum'],
    columns: [
      {
        header: '품번',
        name: 'proName',
        editor: 'text'
      },
      {
        header: '품명',
        name: '품명',
        editor: 'text'
      },
      {
        header: '규격',
        name: 'unit',
        editor: 'text'
      },
      {
        header: '단위',
        name: 'standard',
        editor: 'text'
      },
      {
        header: '납기일',
        name: '납기일',
        editor: {
            type: 'datePicker',
            options: {
              format: 'yyyy-MM-dd'
            }
          }
        },
          {
        header: '발주수량',
        name: '발주수량',
        editor: 'text'
	  },
      {
        header: '단가',
        name: '단가',
        editor: 'text'
      },
      {
        header: '공급가',
        name: '공급가',
        editor: 'text'
      }
    ]
  });
 
       
       var modalGrid = new tui.Grid({
    	      el: document.getElementById('modalGrid'),
    	      bodyHeight: 200,
    	      scrollX: true,
    	      scrollY: true,
    	      columns: [
    	         {
    	            header: '부서',
    	            name: 'empDept',
    	         },
    	         {
    	            header: '사원',
    	            name: 'empName',
    	         }
    	      ]
    	   });
      
       modalGrid.on("click", event => {
    	   //console.log("inner modal grd ", modalGrid.getRow(event.rowKey).empName)
    	  let managers = [
    		  {
    			  "manager" :  modalGrid.getRow(event.rowKey).empName
    		  }
    		  
    	  ] 
    	   
		grid.appendRows(managers)
		
    	$('#empDept').val(modalGrid.getRow(event.rowKey)['empDept']);
		$('#empName').val(modalGrid.getRow(event.rowKey)['empName']);
		$('#large').modal('hide');
       })
       
       staticBackdrop.addEventListener('shown.bs.modal', () => {
       	modalGrid.refreshLayout(); //모달창 새로고침
       })
       
     
   </script>
   </div>
</body>
</html>